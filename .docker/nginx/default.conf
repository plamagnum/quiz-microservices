server {
    listen 80;
    server_name localhost;

    # Директива 1: Обслуговування Фронтенду
    # Всі запити (окрім /api/) йдуть сюди
    location / {
        root /var/www/frontend;
        try_files $uri /index.html; # Обслуговує index.html для SPA-подібної поведінки 
    }

    # Директива 2: Проксіювання API до API Gateway
    # Всі запити до /api/ потрапляють сюди
    location /api {
        # Спроба знайти файл за URI. Якщо ні, то передати на index.php
        try_files $uri /index.php?$query_string;
        
        # Встановлюємо root на директорію *api-gateway* 
        root /var/www/api-gateway/public;
        
        # Передаємо запит до PHP-FPM сервісу 'api-gateway-php'
        # Ім'я 'api-gateway-php' - це ім'я сервісу з docker-compose.yml 
        fastcgi_pass api-gateway-php:9000;
        
        fastcgi_index index.php;
        include fastcgi_params;
        # Вказуємо Nginx, який саме PHP-скрипт виконувати
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
    }
}